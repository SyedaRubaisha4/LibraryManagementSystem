<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - LibraryManagementSystem</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link href="~/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Icon Font Stylesheet -->
    <link href="~/fontawesome-free-6.7.2-web/css/all.min.css" rel="stylesheet" />
    <link href="~/bootstrap-icons-1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="~/bootstrap-icons-1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome CSS (Optional, for icons) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
    <link href="~/lib/owlcarousel/assets/owl.carousel.css" rel="stylesheet" /><link href="~/lib/owlcarousel/assets/owl.theme.green.css" rel="stylesheet" />
    <link href="~/lib/owlcarousel/assets/owl.theme.green.min.css" rel="stylesheet" />
    <link href="~/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="~/LibraryManagementSystem.styles.css" asp-append-version="true" />
    <style>
        .dropdown-item.active {
            background-color: white; /* Bootstrap primary color (blue) */
            color: darkblue !important;
            font-weight: bold;
            /* Change text color to white */
             /* Optional: Make the text bold */
        }

    </style>
</head>
<body>
    <div class="container-xxl position-relative bg-white d-flex p-0"
            <header>
                <div class="sidebar">
                    <nav class="navbar  navbar-light">
               
            
                          <div class="d-flex align-items-center ms-4 mt-5 mb-4">
                            <div class="position-relative">
                                <img class="rounded-circle"src="~/img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
                            </div>
                            <div class="ms-3">
                              
                                <a href="/user/userinfo" style="text-decoration:none;color:black"><span>My Profile</span></a>
                            </div>
                          </div>
             

                    <div class="navbar-nav w-100">
                        <a asp-action="AddUser" asp-controller="User"
                           class="nav-item nav-link @(ViewContext.RouteData.Values["Controller"].ToString() == "User" && ViewContext.RouteData.Values["Action"].ToString() == "AddUser" ? "active" : "")">
                            <i class="bi bi-people-fill me-2"></i>Users
                        </a>

                        <a asp-action="ViewBook" asp-controller="Book"
                           class="nav-item nav-link @(ViewContext.RouteData.Values["Controller"].ToString() == "Book" && ViewContext.RouteData.Values["Action"].ToString() == "ViewBook" ? "active" : "")">
                            <i class="bi bi-book me-2"></i>Books
                        </a>

                        <a asp-action="Userpayments" asp-controller="Book"
                           class="nav-item nav-link @(ViewContext.RouteData.Values["Controller"].ToString() == "Book" && ViewContext.RouteData.Values["Action"].ToString() == "Userpayments" ? "active" : "")">
                            <i class="bi bi-wallet2 me-2"></i>All Payments
                        </a>
                         <a asp-action="index" asp-controller="Category"
                           class="nav-item nav-link @(ViewContext.RouteData.Values["Controller"].ToString() == "Category" && ViewContext.RouteData.Values["Action"].ToString() == "Index" ? "active" : "")">
                            <i class="bi bi-wallet2 me-2"></i>Books Category
                        </a>
      <div class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                <i class="bi bi-card-checklist me-2"></i>Reports
            </a>
            <div class="dropdown-menu bg-transparent border-0">
                <a href="/Reports/BookBorrowReportss" class="dropdown-item" style="text-decoration:none;color:darkblue"><i class="bi bi-list-stars me-2"></i>Most Borrowed Books</a>
                <a href="/Reports/BookBorrowLeastReportss" class="dropdown-item" style="text-decoration:none;color:darkblue"><i class="bi bi-list-stars me-2"></i>Least Borrowed Books </a>
                <a href="/Reports/InactiveUsersReport" class="dropdown-item" style="text-decoration:none;color:darkblue"><i class="bi bi-list-stars me-2"></i>Inactive Users </a>
                <a href="/Reports/ActiveUsersReport" class="dropdown-item" style="text-decoration:none;color:darkblue"><i class="bi bi-list-stars me-2"></i>Active Users Report</a>
                <a href="/Reports/FineReport" class="dropdown-item" style="text-decoration:none;color:darkblue"><i class="bi bi-list-stars me-2"></i>Fine Report</a>
              
            </div>
      </div>

     
    
    <a asp-action="Logouts" asp-controller="Home"
       class="nav-item nav-link @(ViewContext.RouteData.Values["Controller"].ToString() == "Home" && ViewContext.RouteData.Values["Action"].ToString() == "Logouts" ? "active" : "")">
        <i class="bi bi-box-arrow-in-right me-2"></i>Logout
    </a>

</div>

                    </nav>
                </div> 
             
            </header>
            <div class="content">
                   <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
                      <div class="container-fluid">
                            <a href="#" style="text-decoration:none" class="sidebar-toggler flex-shrink-0 disabled" id="sidebar-toggler" aria-disabled="true">
                                <i class="fa fa-bars"></i>
                            </a>

                           <a class="navbar-brand" asp-area="" asp-action="ViewBook" asp-controller="Book">LibraryManagementSystem</a>
                            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                                    aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                          
                   </div>
                      </div>
                   </nav>
                    <!-- Navbar End -->
                <main role="main" class="pb-3">
                   <div class="p-5" style="background-color">

                    @RenderBody()
                    </div>
                </main>
            </div>

 
    </div>
    <script>
        function setUserId(userId) {
            $.ajax({
                url: '/Book/GetUserDetails',
                type: 'GET',
                data: { id: userId },
                success: function (data) {
                    const modal = $('#exampleModal-' + userId);

                    // Populate input fields
                    modal.find('input[name="Name"]').val(data.name);
                    modal.find('input[name="Description"]').val(data.description);
                    modal.find('input[name="Author"]').val(data.author);
                    modal.find('input[name="BookCreationDate"]').val(data.bookCreationDate);
                    modal.find('input[name="Price"]').val(data.price);

                    // Bind image to the preview element
                    const imagePreview = modal.find('#profileImagePreview-' + userId);
                    if (data.profileImage) {
                        imagePreview.attr('src', data.profileImage).show(); // Show image if it exists
                    } else {
                        imagePreview.hide(); // Hide if no image exists
                    }

                     const pdfLink = modal.find('#pdfFilePreview-' + userId);
                    if (data.pdfFileName) {
                        pdfLink.attr('href', data.pdfFileName).show(); // Show PDF link if it exists
                    } else {
                        pdfLink.hide(); // Hide if no PDF exists
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching book details:', error);
                    alert('Failed to fetch book details.');
                }
            });
        }



    </script>
    <script>
        $('#loadUsers').click(function () {
            $.ajax({
                url: '/User/GetUsers', 
                method: 'GET',
                success: function (data) {
                    const userList = $('#userList');
                    userList.empty(); 

                    if (data.length === 0) {
                        userList.html('<p>No users found.</p>');
                        return;
                    }

                    const ul = $('<ul class="list-group"></ul>');
                    data.forEach(user => {
                        const li = $(`<li class="list-group-item">${user.firstName} ${user.lastName} - ${user.email}</li>`);
                        ul.append(li);
                    });

                    userList.append(ul);
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    alert('Unable to load users.');
                }
            });
        });

    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            $("button[data-bs-toggle='modal']").click(function () {
                let buttonId = $(this).attr('id');
                let itemId = buttonId.split('-')[1];
                let userSelect = $(`#userSelect-${itemId}`);

                userSelect.empty().append('<option value="">Loading...</option>');
                $.ajax({
                    url: '/Book/GetUsers',
                    method: 'GET',
                    success: function (data) {
                        console.log("AJAX Response Data:", data);
                        if (data && data.length > 0) {
                            userSelect.empty();
                            userSelect.append('<option value="">Select User</option>');
                            data.forEach(user => {
                                userSelect.append(`<option value="${user.Id}">${user.FirstName} ${user.LastName}</option>`);
                            });
                        } else {
                            userSelect.empty().append('<option value="">No users available</option>');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("Error fetching users:", error);
                        userSelect.empty().append('<option value="">Error loading users</option>');
                    }
                });

  
                $(`#confirmReserve-${itemId}`).off('click').on('click', function () {
                    let userId = userSelect.val(); 
                    if (!userId) {
                        alert("Please select a user.");
                        return;
                    }
                    reserveBook(itemId, userId); 
                });
            });
        });

        function reserveBook(bookId, userId) {
            const requestData = { bookId: bookId, userId: userId };
            console.log("Request Data:", requestData);

            $.ajax({
                url: '/Book/ReserveBook',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(requestData),
                success: function (response) {
                    alert("Book reserved successfully!");
                    location.reload();
                },
                error: function (xhr, status, error) {
                    console.error("Error reserving book:", xhr.responseText || error);
                    alert("Failed to reserve book. Please try again.");
                }
            });
        }

    </script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/chart/chart.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    <script src="~/lib/chart/chart.min.js"></script>
    <script src="~/lib/easing/easing.js"></script>
    <script src="~/lib/owlcarousel/owl.carousel.js"></script>
    <script src="~/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="~/lib/waypoints/waypoints.min.js"></script>
    <script src="~/lib/easing/easing.min.js"></script>

 
    @await RenderSectionAsync("Scripts", required: false)
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const currentUrl = window.location.pathname;
        const dropdownItems = document.querySelectorAll(".dropdown-item");

        dropdownItems.forEach(item => {
            if (item.getAttribute("href") === currentUrl) {
                item.classList.add("active"); // Add 'active' class
            }
        });
    });
</script>
</body>
</html>
